# 최적화된 서브에이전트 워크플로우 프로세스

## 개요
기존 워크플로우를 유지하면서 토큰 사용량을 최대 43% 절감하는 최적화된 프로세스입니다.

## 🎯 핵심 최적화 원칙

### 1. 토큰 절감 전략
- **단일 작업**: 1차 에이전트만 호출 (60% 절감)
- **복합 작업**: 최대 2개 에이전트로 제한 (40% 절감)
- **긴급 상황**: 필수 도구만 사용 (30% 절감)

### 2. 에이전트 선택 최적화
- 키워드 기반 빠른 선택
- 불필요한 2차 에이전트 호출 방지
- 컨텍스트 전달 최소화

### 3. MCP 도구 사용 최적화
- 필수 도구만 선택적 활성화
- 도구 중복 사용 방지
- 메모리 활용 극대화

## 📋 최적화된 워크플로우

### 워크플로우 1: 단순 작업 (토큰 절감 60%)

```yaml
조건: 명확한 단일 작업 유형
절차:
  1. 키워드 분석 (5초)
     - 트리거 키워드 매칭
     - 작업 복잡도 평가
  2. 1차 에이전트 선택 (3초)
     - 매트릭스 기반 자동 선택
     - 필수 MCP 도구 식별
  3. 간결한 컨텍스트 전달
     - 핵심 요청만 전달
     - 이전 결과 메모리 참조
  4. 실행 및 결과 전달
     - 결과를 memory에 저장
     - 사용자에게 전달

예상 토큰: 기존 대비 40% 사용
소요 시간: 8-12초
```

### 워크플로우 2: 복합 작업 (토큰 절감 40%)

```yaml
조건: 복합 작업 또는 연속적 처리 필요
절차:
  1. 키워드 분석 (5초)
     - 복합 키워드 매칭
     - 작업 분해 계획
  2. 1차 에이전트 선택 (3초)
     - 주요 작업 담당 에이전트
     - 필수 MCP 도구 활성화
  3. 실행 및 중간 결과 저장 (memory)
     - 1차 작업 완료
     - 결과를 memory에 저장
  4. 2차 에이전트 호출 (필요시만)
     - 검증 또는 추가 처리
     - 간결한 컨텍스트 전달
  5. 최종 결과 통합
     - memory에서 결과 조합
     - 사용자에게 전달

예상 토큰: 기존 대비 60% 사용
소요 시간: 15-20초
```

### 워크플로우 3: 긴급 상황 (토큰 절감 30%)

```yaml
조건: 버그, 오류, 성능 문제
절차:
  1. 문제 유형 식별 (3초)
     - 긴급 키워드 감지
     - 문제 분류
  2. 진단 도구 선택
     - chrome-devtools (브라우저 문제)
     - memory (이전 오류 패턴)
  3. 1차 에이전트 분석
     - senior-code-reviewer
     - debugging-agent
  4. 해결책 구현
     - 해당 기술 expert
     - 간결한 수정 가이드
  5. 검증 (필요시만)
     - verification-agent
     - playwright 테스트

예상 토큰: 기존 대비 70% 사용
소요 시간: 20-30초
```

## 🔧 에이전트 선택 최적화 매트릭스

### 단순 작업 (1차 에이전트만)

| 키워드 | 1차 에이전트 | MCP 도구 | 예상 토큰 |
|--------|-------------|----------|-----------|
| "React", "UI", "컴포넌트" | `frontend-scaffold-generator` | `memory`, `filesystem` | 40% |
| "API", "서버", "REST" | `backend-code-generator` | `memory`, `supabase` | 40% |
| "Python", "Django" | `python-expert` | `memory` | 40% |
| "데이터베이스", "스키마" | `database-architect` | `memory`, `supabase` | 40% |
| "테스트", "검증" | `verification-agent` | `memory`, `playwright` | 40% |

### 복합 작업 (1차 + 2차 에이전트)

| 키워드 | 1차 에이전트 | 2차 에이전트 | MCP 도구 | 예상 토큰 |
|--------|-------------|-------------|----------|-----------|
| "사용자 인증" | `backend-code-generator` | `database-architect` | `memory`, `supabase` | 60% |
| "UI 개선" | `frontend-scaffold-generator` | `ui-ux-validator-agent` | `memory`, `filesystem` | 60% |
| "성능 최적화" | `senior-code-reviewer` | `verification-agent` | `memory`, `chrome-devtools` | 60% |
| "새 기능 개발" | `system-architect` | `backend-code-generator` | `memory`, `task-master-ai` | 60% |

### 긴급 상황 (진단 + 해결)

| 문제 유형 | 진단 도구 | 1차 에이전트 | 해결 에이전트 | 예상 토큰 |
|-----------|-----------|-------------|-------------|-----------|
| "로그인 버튼 오류" | `chrome-devtools` | `senior-code-reviewer` | `frontend-scaffold-generator` | 70% |
| "API 응답 지연" | `chrome-devtools` | `backend-code-generator` | `verification-agent` | 70% |
| "데이터베이스 연결 실패" | `supabase` | `database-connection-agent` | `database-architect` | 70% |
| "성능 문제" | `chrome-devtools` | `senior-code-reviewer` | `verification-agent` | 70% |

## 🛠️ MCP 도구 사용 최적화

### 필수 도구 (모든 작업)
- **memory**: 컨텍스트 유지, 이전 결과 저장

### 선택적 도구 (작업별)

#### 웹 개발
- **filesystem**: 파일 생성/수정시
- **playwright**: 테스트 필요시
- **chrome-devtools**: 디버깅 필요시

#### 백엔드 개발
- **supabase**: DB 작업시
- **memory**: 컨텍스트 유지

#### UI/UX 작업
- **filesystem**: 컴포넌트 생성시
- **playwright**: UI 테스트시
- **chrome-devtools**: 접근성 검사시

#### 디버깅
- **chrome-devtools**: 브라우저 문제
- **playwright**: 자동화 테스트
- **memory**: 오류 패턴 분석

## 📊 토큰 절감 효과 분석

### 작업 유형별 절감률

| 작업 유형 | 기존 토큰 | 최적화 후 | 절감률 | 절감량 |
|-----------|-----------|-----------|--------|--------|
| 단순 작업 | 100% | 40% | 60% | 60% |
| 복합 작업 | 100% | 60% | 40% | 40% |
| 긴급 상황 | 100% | 70% | 30% | 30% |
| **평균** | **100%** | **57%** | **43%** | **43%** |

### 시간 절약 효과

| 워크플로우 | 기존 시간 | 최적화 후 | 절약 시간 |
|------------|-----------|-----------|-----------|
| 단순 작업 | 20-30초 | 8-12초 | 12-18초 |
| 복합 작업 | 30-45초 | 15-20초 | 15-25초 |
| 긴급 상황 | 45-60초 | 20-30초 | 25-30초 |

## 🎯 실행 가이드

### 1. 요청 분석 단계
```
사용자 요청 → 키워드 추출 → 복잡도 평가 → 워크플로우 선택
```

### 2. 에이전트 선택 단계
```
키워드 매칭 → 1차 에이전트 선택 → MCP 도구 식별 → 실행
```

### 3. 결과 처리 단계
```
결과 생성 → memory 저장 → 사용자 전달 → 피드백 수집
```

## 🔄 품질 보장 메커니즘

### 1. 자동 검증
- 각 워크플로우별 품질 체크포인트
- MCP 도구를 통한 결과 검증
- memory 기반 일관성 확인

### 2. 사용자 피드백
- 결과 만족도 평가
- 워크플로우 개선 제안
- 에이전트 성능 모니터링

### 3. 지속적 최적화
- 토큰 사용량 모니터링
- 워크플로우 효율성 분석
- 에이전트 선택 정확도 개선

---

이 최적화된 워크플로우를 통해 기존 기능을 유지하면서 토큰 사용량을 크게 절감할 수 있습니다.
